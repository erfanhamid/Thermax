@model BEEERP.Models.ViewModel.Payroll.SalaryDeductionVModel
@{
    ViewBag.Title = "SalaryDeduction";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    tbody tr:hover {
        background-color: dodgerblue;
        color: white;
        cursor: pointer;
    }

    .btn:hover {
        color: blue !important;
    }
    /*#loader {
        display: none;
        position: absolute;
        left: 50%;
        top: 50%;
        z-index: 1;
        width: 150px;
        height: 150px;
        margin: -75px 0 0 -75px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        border-bottom: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
    }*/

    @@-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>
@using (Html.BeginForm("ShowSalaryDeductionReport", "SalaryDeduction", FormMethod.Post, new { id = "salarydeductionReport", target = "_blank" }))
{
    <h3 style="text-align:center">Employee Salary Deduction</h3>
    <div class="content">
        <div class="row">
            <div class="form-horizontal">
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box ">
                                <div class="box-header with-border box-head-back">
                                    <h3 class="box-title">Deduction Section </h3>
                                </div>
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.EmployeeID, "Employee ID ", new { @class = "col-md-4 control-label" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.EmployeeID, new { @class = "form-control", @ReadOnly = "ReadOnly" })
                                                    @Html.ValidationMessageFor(m => m.EmployeeID, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.EmployeeName, "Employee Name ", new { @class = "col-md-4 control-label" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.EmployeeName, new { @class = "form-control", @ReadOnly = "ReadOnly" })
                                                    @Html.ValidationMessageFor(m => m.EmployeeName, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.Designation, "Designation ", new { @class = "col-md-4 control-label" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.Designation, new { @class = "form-control", @ReadOnly = "ReadOnly" })
                                                    @Html.ValidationMessageFor(m => m.Designation, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.IncomeTax, "Income Tax ", new { @class = "col-md-4 control-label" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.IncomeTax, new { @class = "form-control", @type = "number" })
                                                    @Html.ValidationMessageFor(m => m.IncomeTax, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.ProvidentFund, "Provident Fund", new { @class = "col-md-4 control-label" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.ProvidentFund, new { @class = "form-control", @type = "number" })
                                                    @Html.ValidationMessageFor(m => m.ProvidentFund, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.MCAdjustment, "MC Adjustment", new { @class = "col-md-4 control-label", @title = "Tax deduction at source" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.MCAdjustment, new { @class = "form-control", @type = "number" })
                                                    @Html.ValidationMessageFor(m => m.MCAdjustment, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.AdvanceAdjustment, "Advance Adjustment ", new { @class = "col-md-4 control-label" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.AdvanceAdjustment, new { @class = "form-control", @type = "number" })
                                                    @Html.ValidationMessageFor(m => m.AdvanceAdjustment, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                @Html.LabelFor(m => m.OtherAdjustment, "Other Adjustment", new { @class = "col-md-4 control-label" })
                                                <div class="col-sm-8 input-group" style="padding-left:15px; padding-right:15px">
                                                    @Html.TextBoxFor(m => m.OtherAdjustment, new { @class = "form-control", @type = "number" })
                                                    @Html.ValidationMessageFor(m => m.OtherAdjustment, "", new { @style = "color: red" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr />
                                    <div class="row" style="padding-left:20%">
                                        <div class="col-md-2 col-sm-3">
                                            <div class="form-group">
                                                <button class="btn skin-blue" id="Save" style="min-width:200px;">Update Deduction Info</button>
                                            </div>
                                        </div>
                                        <div class="col-md-2 col-sm-3">
                                            <div class="form-group">
                                                <button class="btn skin-blue" id="Reset" style="min-width:200px;">Reset</button>
                                            </div>
                                        </div>
                                        <div class="col-md-2 col-sm-3">
                                            <div class="form-group">
                                                <button class="btn skin-blue" id="delete" style="min-width:200px;">Delete</button>
                                            </div>
                                        </div>
                                        <div class="col-md-2 col-sm-3">
                                            <div class="form-group">
                                                <button class="btn skin-blue"  id="print" type="submit" style="min-width:200px;">Print</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-horizontal">
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box ">
                                <div class="box-header with-border box-head-back">
                                    <h3 class="box-title">Employees Salary Deduction Information</h3>
                                </div>
                                <div class="box-body">
                                    <table class="table table-responsive" id="deductionTable">
                                        <thead>
                                            <tr>
                                                <td>Employee Id</td>
                                                <td>Name</td>
                                                <td>Designation</td>
                                                <td>Income Tax</td>
                                                <td>Provident Fund</td>
                                                <td>MC Adjustment</td>
                                                <td>Advance Adjustment</td>
                                                <td>Other Adjustment</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in ViewBag.list)
                                            {
                                                <tr value="@item.EmployeeID" class="clickable-row">
                                                    <td>@item.EmployeeID</td>
                                                    <td>@item.EmployeeName</td>
                                                    <td>@item.Designation</td>
                                                    <td>@item.IncomeTax</td>
                                                    <td>@item.ProvidentFund</td>
                                                    <td>@item.MCAdjustment</td>
                                                    <td>@item.AdvanceAdjustment</td>
                                                    <td>@item.OtherAdjustment</td>
                                                    @*<td> <a href="#" style="padding-right:40px;"><i class="fa fa-edit" value="@item.DeptmentID" id="edit"></i> </a></td>*@
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                    <div class="loader" id="loader"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
}


@section scripts{
    <script>
    document.getElementById("loader").style.display = "block";
    var salaryDeduction = { EmployeeID: 0, EmployeeName:"", Designation:"", AdvanceAdjustment:0.0, IncomeTax:0.0, ProvidentFund:0.0, OtherAdjustment:0.0, MCAdjustment:0.0 };
    var table = $('#deductionTable').DataTable({
        'paging': true,
        'lengthChange': false,
        'searching': true,
        'ordering': true,
        'info': true,
        'autoWidth': false,
        'scrollX': true,
    });
    $(document).on('click', "#Reset", function () {
        RemoveError();
        Reset();
        Location.reload();
        $("#Save").prop('disabled', true);
    });
    $(document).on('click', "#Save", function () {
        SetDeduction();
        if ($("#AdvanceAdjustment").val() == "") {
            setError("AdvanceAdjustment", "Advance Adjustment is required field, If No Adjust Put, 0(Zero)");
        }
        else if ($("#IncomeTax").val() == "") {
            setError("IncomeTax", "Income Tax is required field, If No Tax Put, 0(Zero)");
        }
        else if ($("#ProvidentFund").val() == "") {
            setError("ProvidentFund", "PFOwn is required field, If No PFOwn, Put 0(Zero)");
        }
        else if ($("#MCAdjustment").val() == "") {
            setError("MCAdjustment", "MC Adjustment is required field, If No PFOwn, Put 0(Zero)");
        }
        else if ($("#OtherAdjustment").val() == "") {
            setError("OtherAdjustment", "Other Adjustment is required field, If No OtherAdjust, Put 0(Zero)");
        }
            else {
            if (confirm('Do you want to Save ?')) {

                $.ajax({
                url: '@Url.Action("SaveEmployeeSalaryDeduction", "SalaryDeduction")',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({ EmployeeSalaryDeductions: salaryDeduction }),
                type: 'POST',
                dataType: 'json',
                success: function (datas) {
                    if (datas == 0) {
                        alert("Failed to Save");
                    }
                    else {
                        alert("Sucessfull Saved");
                        location.reload();
                    }
                }
                });
            }
        }
    });
    //Clikable Row
    $(document).on('click', ".clickable-row", function () {
        var id = $(this).attr("value");

            $.ajax({
            url: '@Url.Action("GetEmployeeSalaryDeductions", "SalaryDeduction")',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({ EmployeeId: id }),
            type: 'POST',
            dataType: 'json',
            success: function (datas) {
                if (datas.Message==0)
                {
                    alert("This Employee Salary Deductions  doesn't exist.");
                }
                else {
                    $("#Reset").show();
                    $("#Save").show();
                    $("#delete").show();
                    $("#EmployeeID").val(datas.employeesalarydeduction.EmployeeID);
                    $("#EmployeeName").val(datas.employeesalarydeduction.EmployeeName);
                    $("#Designation").val(datas.employeesalarydeduction.Designation);
                    $("#IncomeTax").val(datas.employeesalarydeduction.IncomeTax);
                    $("#ProvidentFund").val(datas.employeesalarydeduction.ProvidentFund);
                    $("#MCAdjustment").val(datas.employeesalarydeduction.MCAdjustment);
                    $("#AdvanceAdjustment").val(datas.employeesalarydeduction.AdvanceAdjustment);
                    $("#OtherAdjustment").val(datas.employeesalarydeduction.OtherAdjustment);
                }
            }
        });
    });
    $(document).ready(function () {
        //event.preventDefault();
        table = $("#deductionTable").DataTable();
        //$("#Save").prop('disabled', true);
        //getResult();
        Reset();
        RemoveError();
    });
    function getResult() {
        $.ajax({
            type: "GET",
            //url: "/AttendanceLog/GetSearchResult",
            url: '@Url.Action("GetAllEmployeeInfo", "SalaryDeduction")',
            contentType: "application/Json;charset=utf-8",
            data: JSON.stringify(),
            success: function (rData) {
                if (rData != null || rData.length != 0) {
                    table.clear().draw();
                    var list = rData;
                    $.each(list, function (index, value) {
                        table.row.add([value.EmployeeID, value.EmployeeName, value.AdvanceAdjustment, value.IncomeTax, value.ProvidentFund, value.OtherAdjustment, value.Designation, value.CompanyName, value.MCAdjustment]).draw();;
                    });
                    document.getElementById("loader").style.display = "none";
                }
            },
            error: function () {
                alert("Please check your internet connection first. If this doesn't solve your problem, then Contact With Paankouri Software & Services");
            }
        });
    }
    //Delete
    $(document).on('click', '#delete', function () {
        $("#Save").prop('disabled', true);
        $("#delete").prop('disabled', true);
        var id = parseInt( $("#EmployeeID").val());
            if (confirm('Are you sure you want to delete this from the database?')) {
                $.ajax({
                    url: '@Url.Action("DeleteEmployeeSalarayDeductionById", "SalaryDeduction")',
                    contentType: "application/json;charset=utf-8",
                    data: { EmployeeID: id },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 0) {
                            alert("Delete failed.");
                        }
                        else {
                            alert("Delete Successfull");
                            location.reload();
                        }
                    }
                });
            }
    });

    $(document).on('click', "#print", function (event) {
        //event.preventDefault();
        $("#print").attr("action", "/SalaryDeduction/ShowSalaryDeductionReport"),
            $("#print").submit();

    });
    function SetDeduction() {
        salaryDeduction.EmployeeID = $("#EmployeeID").val();
        salaryDeduction.EmployeeName = $("#EmployeeName").val();
        salaryDeduction.AdvanceAdjustment = $("#AdvanceAdjustment").val();
        salaryDeduction.IncomeTax = $("#IncomeTax").val()
        salaryDeduction.ProvidentFund = $("#ProvidentFund").val();
        salaryDeduction.OtherAdjustment = $("#OtherAdjustment").val();
        salaryDeduction.MCAdjustment = $("#MCAdjustment").val();
        salaryDeduction.Designation = $("#Designation").val();
    }
    function Reset() {
        $("#EmployeeID").val("");
        $("#EmployeeName").val("");
        $("#AdvanceAdjustment").val("");
        $("#IncomeTax").val("");
        $("#TMPhone").val("");
        $("#ProvidentFund").val("");
        $("#Designation").val("");
        $("#CompanyName").val("");
        $("#MCAdjustment").val("");
    }
    </script>
}
